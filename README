# If you don't have a PKGLIST: check out habs and regenerate it
git clone git://github.com/archhaskell/habs.git
scripts/extract-pkglist > PKGLIST

# Update the Hackage tarball
cabal update

# find inconsistencies
(cd scripts && ghc -o findconflicts findconflicts.hs -Wall -package archlinux -threaded)
scripts/findconflicts PKGLIST ~/.cabal/packages/hackage.haskell.org/00-index.tar +RTS -N4

# find updates
(cd scripts && ghc -o findupdates findupdates.hs -Wall -package archlinux -threaded)
scripts/findupdates PKGLIST ~/.cabal/packages/hackage.haskell.org/00-index.tar +RTS -N4

# Create chroots for building
scripts/setup-chroots

# Create a new PKGBUILD tree
# TODO: implement setting pkgrel from PKGLIST in manycabal2arch
cabal2arch convtar PKGLIST ~/.cabal/packages/hackage.haskell.org/00-index.tar habs

# Batch build it (use toposort from archlinux/tests)
# Packages go to chroot-$arch/repo
./makeworld

# Sync pacman mirror
rsync -vaH chroot-i686/copy/repo/ /usr/local/apache/htdocs/localhost/arch-haskell/
